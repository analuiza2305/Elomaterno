<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EloMaterno - Home</title>
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/home.css">
    <link rel="stylesheet" href="./css/globals.css">
    <link rel="icon" type="image/svg+xml" href="./img/iconelogo.svg">
    <link rel="alternate icon" type="image/png" href="./img/iconelogo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

    <svg aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;">
        <defs>
            <filter id="protanopia">
                <feColorMatrix type="matrix" values="
            0.567 0.433 0 0 0
            0.558 0.442 0 0 0
            0     0.242 0.758 0 0
            0     0     0     1 0" />
            </filter>
            <filter id="deuteranopia">
                <feColorMatrix type="matrix" values="
            0.625 0.375 0 0 0
            0.700 0.300 0 0 0
            0     0.300 0.700 0 0
            0     0     0     1 0" />
            </filter>
            <filter id="tritanopia">
                <feColorMatrix type="matrix" values="
            0.950 0.050 0     0 0
            0     0.433 0.567 0 0
            0     0.475 0.525 0 0
            0     0     0     1 0" />
            </filter>
            <filter id="Acromatopsia">
                <feColorMatrix type="matrix" values="
            0.299 0.587 0.114 0 0
            0.299 0.587 0.114 0 0
            0.299 0.587 0.114 0 0
            0     0     0     1 0" />
            </filter>
        </defs>
    </svg>

    <header class="top-header">
        <div class="left-section">
            <div class="logo-area">
                <a href="home.html" class="botao-link">
                    <img src="./img/logo_icon.png" alt="Ícone Empresa" class="icon">
                </a>
                <span class="company-name">elomaterno</span>
            </div>

            <div class="search-box">
                <input type="text" id="global-search" placeholder="Pesquisar...">
                <button class="btn-search"><i class="fa fa-search"></i></button>
                <button class="btn-filter"><i class="fa fa-sliders"></i></button>

                <div id="filter-menu" class="filter-menu hidden">
                    <label><input type="checkbox" value="todos" checked> Todos</label>
                    <label><input type="checkbox" value="posts"> Posts</label>
                    <label><input type="checkbox" value="artigos"> Artigos</label>
                    <label><input type="checkbox" value="eventos"> Eventos</label>
                    <label><input type="checkbox" value="perfis"> Perfis</label>
                </div>

                <div id="search-results" class="search-results hidden"></div>
            </div>

        </div>

        <div class="right-section">

            <div class="accessibility-selector">
                <button id="accessibility-toggle" aria-label="Opções de acessibilidade">
                    <i class="fa fa-universal-access" aria-hidden="true"></i>
                </button>
                <ul id="accessibility-menu" class="hidden">
                    <li id="increase-font">
                        <i class="fa fa-plus-circle" aria-hidden="true"></i> Aumentar Fonte
                    </li>
                    <li id="decrease-font">
                        <i class="fa fa-minus-circle" aria-hidden="true"></i> Diminuir Fonte
                    </li>
                    <li id="colorblind-filter">
                        <i class="fa fa-low-vision" aria-hidden="true"></i> Filtros Daltonismo
                    </li>
                    <li id="screen-reader">
                        <i class="fa fa-assistive-listening-systems" aria-hidden="true"></i> Leitura em Voz
                    </li>
                    <li id="reading-mask">
                        <i class="fa fa-highlighter" aria-hidden="true"></i> Máscara de leitura
                    </li>
                    <li id="bold-text">
                        <i class="fa fa-bold" aria-hidden="true"></i> Letras destacadas
                    </li>
                    <li id="high-contrast">
                        <i class="fa fa-adjust" aria-hidden="true"></i> Alto contraste
                    </li>
                    <li id="increase-line">
                        <i class="fa fa-arrows-alt-v" aria-hidden="true"></i> Aumentar Espaçamento Linhas
                    </li>
                    <li id="decrease-line">
                        <i class="fa fa-compress-arrows-alt" aria-hidden="true"></i> Diminuir Espaçamento Linhas
                    </li>
                    <li id="reset-accessibility">
                        <i class="fa fa-undo" aria-hidden="true"></i> Redefinir
                    </li>
                </ul>
            </div>

            <div id="reading-mask-overlay">
                <div class="highlight-window"></div>
            </div>

            <div class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon" id="theme-toggle" aria-label="Alternar tema claro e escuro"></i>
            </div>

            <div class="logout-btn" id="logoutBtn" title="Sair da conta">
                <i class="fa fa-sign-out"></i>
            </div>
            <div class="user-avatar">
                <a href="perfil.html">
                    <div class="avatar-loader-container">
                        <img id="perfil-avatar">
                        <div class="loader">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

    </header>

    <button id="extenderToggle" class="extender" aria-label="Abrir menu" aria-expanded="false" title="Abrir menu">
        <i class="fa fa-chevron-down" aria-hidden="true"></i>
    </button>

    <button id="menuToggle" class="menu-toggle">☰</button>

    <div class="botoes">
        <div class="menu-user">
            <a href="perfil.html">
                <div class="avatar-loader-container">
                    <img id="menu-avatar" src="./img/avatar_usuario.png" alt="Avatar do usuário">
                    <div class="loader">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                </div>
            </a>

            <br>

            <h3 id="menu-nome">
                <div class="loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </h3>
            <span id="menu-email">
                <div class="loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </span>
        </div>

        <a href="chat.html" class="botao-link">
            <div class="botao-item">
                <i class="fa-solid fa-message"></i>
                <span>Chats</span>
            </div>
        </a>

        <a href="consultoria.html" class="botao-link">
            <div class="botao-item">
                <i class="fa fa-comments"></i>
                <span>Consultorias</span>
            </div>
        </a>

        <a href="forum.html" class="botao-link">
            <div class="botao-item">
                <i class="fa fa-users"></i>
                <span>Fórum</span>
            </div>
        </a>

        <a href="home.html" class="botao-link home-btn">
            <div class="botao-item ativo">
                <i class="fa fa-home"></i>
                <span>Home</span>
            </div>
        </a>

        <a href="artigos.html" class="botao-link">
            <div class="botao-item">
                <i class="fa fa-book"></i>
                <span>Artigos</span>
            </div>
        </a>

        <a href="calendario.html" class="botao-link">
            <div class="botao-item">
                <i class="fa fa-calendar"></i>
                <span>Calendário</span>
            </div>
        </a>

        <a href="eventos.html" class="botao-link">
            <div class="botao-item">
                <i class="fa fa-bell"></i>
                <span>Eventos</span>
            </div>
        </a>

        <div class="menu-actions">
            <div class="theme-toggle mobile-toggle" id="menuThemeToggle">
                <i class="fas fa-moon" id="menu-theme-toggle-icon"></i>
            </div>
            <div class="logout-btn mobile-logout" id="menuLogoutBtn" title="Sair da conta">
                <i class="fa fa-sign-out"></i>
            </div>

            <div class="accessibility-selector">
                <button id="accessibility-toggle-mobile" aria-label="Opções de acessibilidade">
                    <i class="fa fa-universal-access" aria-hidden="true"></i>
                </button>
                <ul id="accessibility-menu-mobile" class="hidden">
                    <li data-action="increase-font"><i class="fa fa-plus-circle"></i> Aumentar Fonte</li>
                    <li data-action="decrease-font"><i class="fa fa-minus-circle"></i> Diminuir Fonte</li>
                    <li data-action="colorblind-filter"><i class="fa fa-low-vision"></i> Filtros Daltonismo</li>
                    <li data-action="screen-reader"><i class="fa fa-assistive-listening-systems"></i> Leitura em Voz
                    </li>
                    <li data-action="reading-mask"><i class="fa fa-highlighter"></i> Máscara de leitura</li>
                    <li data-action="bold-text"><i class="fa fa-bold"></i> Letras destacadas</li>
                    <li data-action="high-contrast"><i class="fa fa-adjust"></i> Alto contraste</li>
                    <li data-action="increase-line"><i class="fa fa-arrows-alt-v"></i> Aumentar Espaçamento Linhas</li>
                    <li data-action="decrease-line"><i class="fa fa-compress-arrows-alt"></i> Diminuir Espaçamento
                        Linhas</li>
                    <li data-action="reset-accessibility"><i class="fa fa-undo"></i> Redefinir</li>
                </ul>

            </div>
        </div>

    </div>

    <main class="home-sections">
        <section class="hero-section com-brilho animar-entrada" style="animation-delay: 0.1s;">
            <img src="./img/dicaHome_banner.png" alt="Banner" class="hero-img">
            <div class="hero-cta">
                <a href="artigos.html" class="botao-acao">Ver mais artigos em destaque</a>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h3>Do fórum</h3>
                <a class="ver-mais" href="forum.html">Ver mais</a>
            </div>
            <div class="cards-grid" id="forum-preview">
                <div class="loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>

        </section>

        <section class="section">
            <div class="section-header">
                <h3>Artigos</h3>
                <a class="ver-mais" href="artigos.html">Ver mais</a>
            </div>
            <div class="cards-grid" id="artigos-home">
                <div class="loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h3>Eventos</h3>
                <a class="ver-mais" href="eventos.html">Ver eventos</a>
            </div>
            <div class="cards-grid eventos-home">
                <div class="loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h3>Consultorias</h3>
                <a class="ver-mais" href="consultoria.html">Agendar</a>
            </div>
            <div class="cards-grid">
                <div class="mini-card consult-mini grad-roxo com-brilho">
                    <img src="./img/maepsic_icon.png" alt="Consultoria" class="mini-icon">
                    <div>
                        <h4 class="mini-title">Sessões de escuta</h4>
                        <p class="mini-text">Rápidas, gratuitas e acolhedoras com psicólogas voluntárias.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    
    <div id="first-time-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Complete seu perfil</h2>
            <p>Para uma melhor experiência, preencha as informações adicionais:</p>
            <form id="profile-form">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" placeholder="Ex: São Paulo">

                <label for="emprego">Emprego:</label>
                <input type="text" id="emprego" name="emprego" placeholder="Ex: Atendente">

                <label for="filhos">Número de filhos:</label>
                <input type="text" id="filhos" name="filhos" placeholder="Ex: 2">

                <label for="telefone">Telefone:</label>
                <input type="text" id="telefone" name="telefone" required placeholder="Ex: (11) 99999-9999">

                <button type="submit">Salvar e Continuar</button>
            </form>
        </div>
    </div>

    <script type="module" src="./js/globals.js"></script>
    <script type="module" src="./js/home-forum.js"></script>
    <script type="module" src="./js/home-eventos.js"></script>
    <script type="module" src="./js/home-artigos.js"></script>
    <script type="module" src="./js/pesquisa.js"></script>
    <script type="module" src="./js/carregar-avatar.js"></script>

    <script type="module">
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
        import { auth, db } from "./js/firebase.js";

        const modal = document.getElementById("first-time-modal");
        const form = document.getElementById("profile-form");
        const closeBtn = modal.querySelector(".close");

        // Close modal function
        function closeModal() {
            modal.classList.add("hidden");
        }

        // Close on X click
        closeBtn.addEventListener("click", closeModal);

        // Close on outside click
        window.addEventListener("click", (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Form submit
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;

            const updates = {};
            const cidade = document.getElementById("cidade").value.trim();
            if (cidade) updates.cidade = cidade;
            const emprego = document.getElementById("emprego").value.trim();
            if (emprego) updates.emprego = emprego;
            const filhos = document.getElementById("filhos").value.trim();
            if (filhos) updates.filhos = filhos;
            const telefone = document.getElementById("telefone").value.trim();
            if (telefone) updates.telefone = telefone;

            try {
                await updateDoc(doc(db, "usuarios", user.uid), updates);
                closeModal();
                alert("Perfil atualizado com sucesso!");
            } catch (err) {
                console.error("Erro ao salvar:", err);
                alert("Erro ao salvar. Tente novamente.");
            }
        });

        // Check if first time (telefone empty and modal not shown yet)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const snap = await getDoc(doc(db, "usuarios", user.uid));
                    if (snap.exists()) {
                        const data = snap.data();
                        if ((!data.telefone || data.telefone === "") && !data.welcomeModalShown) {
                            modal.classList.remove("hidden");
                            // Mark modal as shown
                            await updateDoc(doc(db, "usuarios", user.uid), { welcomeModalShown: true });
                        }
                    }
                } catch (err) {
                    console.error("Erro ao verificar perfil:", err);
                }
            }
        });
    </script>

</body>

</html>